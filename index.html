<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>GifTastic</title>
</head>

<body>

    <form id="character-form">
        <label for="character-input">Add a Star Wars Character!</label>
        <input type="text" id="character-input"><br>

        <!-- Button triggers new movie to be added -->
        <input id="add-character" type="submit" value="Add a Star Wars Character!">
    </form>
    </div>
    <div id="buttons-view"></div>
    <!-- <button data-character="Jar Jar Binks">Jar Jar</button> -->
    <div id="gifs">



        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script>
            var character = ["Jar Jar Binks", "Luke Skywalker", "Darth Vader",]

            // Function for displaying movie data
            function renderButtons() {

                // Deleting the movies prior to adding new movies
                // (this is necessary otherwise you will have repeat buttons)
                $("#buttons-view").empty();

                // Looping through the array of movies
                for (var i = 0; i < character.length; i++) {

                    // Then dynamicaly generating buttons for each movie in the array
                    // This code $("<button>") is all jQuery needs to create the beginning and end tag. (<button></button>)
                    var a = $("<button>");
                    // Adding a class of movie-btn to our button
                    a.addClass("character-btn");
                    // Adding a data-attribute
                    a.attr("data-name", character[i]);
                    // Providing the initial button text
                    a.text(character[i]);
                    // Adding the button to the buttons-view div
                    $("#buttons-view").append(a);
                }
            };



            function displayGifInfo() {

                var character = $(this).attr("data-name");

                var queryURL = "https://api.giphy.com/v1/gifs/search?q=" +
                    character + "&api_key=gUOyes5bzalWC2SAOM63qdWpM2RyhatG&limit=10";

                $.ajax({
                    url: queryURL,
                    method: "GET"
                })
                    .then(function (response) {
                        console.log(queryURL);

                        console.log(response);
                        // storing the data from the AJAX request in the results variable
                        var results = response.data;

                        // Looping through each result item
                        for (var i = 0; i < results.length; i++) {

                            // Creating and storing a div tag
                            var starWarsCharacter = $("<div>");

                            // Creating a paragraph tag with the result item's rating
                            var p = $("<p>").text("Rating: " + results[i].rating);

                            // Creating and storing an image tag
                            var characterImage = $("<img>");
                            // Setting the src attribute of the image to a property pulled off the result item
                            characterImage.attr("src", results[i].images.fixed_height.url);
                            // characterImage.attr("src", results[i].images.original_still.url);
                            characterImage.attr("data-still", results[i].images.original_still.url);
                            characterImage.attr("data-animate", results[i].images.original.url);
                            characterImage.attr("data-state", "animate");
                            characterImage.attr("class", "gifs");
                                console.log(characterImage)
                            // Appending the paragraph and image tag to the animalDiv
                            starWarsCharacter.append(p);
                            starWarsCharacter.append(characterImage);

                            // Prependng the animalDiv to the HTML page in the "#gifs-appear-here" div
                            $("#gifs").prepend(starWarsCharacter);
                        }
                    })

            };
            // This function handles events where a movie button is clicked
            $("#add-character").on("click", function (event) {
                event.preventDefault();
                // This line grabs the input from the textbox
                var input = $("#character-input").val().trim();

                // Adding movie from the textbox to our array
                character.push(input);

                // Calling renderButtons which handles the processing of our movie array
                renderButtons();
                console.log(character)
            });
           function animateGif () {
                 
                 // The attr jQuery method allows us to get or set the value of any attribute on our HTML element
                 var state = $(this).attr("data-state");
                 var animate = $(this).attr("data-animate");
                 var still = $(this).attr("data-still");
                 // If the clicked image's state is still, update its src attribute to what its data-animate value is.
                 // Then, set the image's data-state to animate
                 // Else set src to the data-still value
                 if (state === "still") {
                     $(this).attr("src", animate);
                     $(this).attr("data-state", "animate");
                 } else {
                     $(this).attr("src", still);
                     $(this).attr("data-state", "still");
                 }
             };

            $(document).on("click", ".character-btn", displayGifInfo);
            $(document).on("click", "#gifs", animateGif);
            renderButtons()
        </script>
</body>

</html>